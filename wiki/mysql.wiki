
= 特别注意 =
  * 本文档是关于在 CentOS 5.5 下安装 MySQL 的方法, 未在其它操作系统测试。
  * MySQL 通过源代码编译安装在默认的路径下 /usr/local/mysql
  * MySQL 配置文件路径是 /etc/my.cnf
  * 运行 mysql server 的系统用户是 mysql

= 快速链接 =
  * [mysql#MySQL_Basic_Operation MySQL Basic Operation]
    * [mysql#start 手工启动 mysql server]
    * [mysql#stop 手工停止 mysql server]
    * [mysql#login 登录 mysql server]
    * [mysql#backup 备份数据]
    * [mysql#show_databases 显示全部数据库]
    * [mysql#create_database 创建新数据库]
    * [mysql#drop_database 删除数据库]
    * [mysql#create_user 创建新用户]
    * [mysql#grant_user_database 赋予用户操作指定数据库的权限]
    * [mysql#delete_user 删除用户]
    * [mysql#edit_user_password 修改指定用户密码]
    * [mysql#start_with_os 设置 mysql server 随系统启动和关闭]
    * [mysql#security mysql 数据库安全设置]
    * [mysql#reset_root_password 重置 root 用户密码]
  * [mysql#how_to_install_mysql_server_5.1.58 how to install mysql server 5.1.58]
  * [mysql#how_to_install_mysql_server_5.5.15 how to install mysql server 5.5.15]
  * [mysql#how_to_install_multi_mysql_server_5.5.15 how to install multi mysql server 5.5.15]
  * [mysql#how_to_uninstall_mysql_server how to uninstall mysql server]

= 参考文档 =
  *  Installing MySQL from a Standard Source Distribution
    * http://dev.mysql.com/doc/refman/5.5/en/installing-source-distribution.html
  * Securing the Initial MySQL Accounts
    * http://dev.mysql.com/doc/refman/5.5/en/default-privileges.html
  * Using Option Files (MySQL 配置文件说明)
    * http://dev.mysql.com/doc/refman/5.5/en/option-files.html
  *  Running Multiple MySQL Instances on One Machine
    * http://dev.mysql.com/doc/refman/5.5/en/multiple-servers.html
  * Running Multiple MySQL Instances on Unix
    * http://dev.mysql.com/doc/refman/5.5/en/multiple-unix-servers.html
  * Nginx 0.8.x + PHP 5.2.13（FastCGI）搭建胜过Apache十倍的Web服务器（第6版）
    * http://blog.s135.com/nginx_php_v6/



----

= MySQL Basic Operation =

== start ==
  * 手工启动 mysql
{{{
/usr/local/mysql/bin/mysqld_safe --user=mysql &
}}}

== stop ==
  * 手工停止 mysql (需要输入 root 用户密码)
{{{
/usr/local/mysql/bin/mysqladmin -u root -p shutdown
}}}

== login ==
 * 登录 mysql server
{{{
# 以 root 用户登录 (接下来将提示输入密码)
/usr/local/mysql/bin/mysql -u root -p
}}}


== backup ==
  * 备份数据

== show databases ==
  * [mysql#login 登录 mysql server]
  * 执行以下 SQL 语句来显示全部数据库
{{{
SHOW DATABASES;
}}}

== create database ==
  * [mysql#login 登录 mysql server]
  * 执行以下 SQL 语句来创建新数据库
{{{
# 创建新数据库 web_db, 使用 utf8 字符集
CREATE DATABASE `web_db` CHARACTER SET utf8;
}}}

== drop database ==
  * [mysql#login 登录 mysql server]
  * 执行以下 SQL 语句来删除数据库
{{{
# 删除数据库 web_db (特别注意：该操作会删除该数据库下的全部数据)
DROP DATABASE `web_db`;
}}}


== create user ==
  * [mysql#login 登录 mysql server]
  * 执行以下 SQL 语句来创建新用户
{{{
# 创建新用户 tom, 密码是 mypass, 只允许通过 localhost 连接 mysql server (如果希望允许远程登录, 则将 localhost 改为 %)
CREATE USER 'tom'@'localhost' IDENTIFIED BY 'mypass';
}}}

== delete user ==
  * [mysql#login 登录 mysql server]
  * 执行以下 SQL 语句来删除用户
{{{
# 删除用户 tom
DELETE FROM mysql.user WHERE user = "tom";
FLUSH PRIVILEGES;
}}}
  * 备注
    * 删除用户也可以使用 DROP USER `[username]`，但需要指定 hostname
    * 详见 http://dev.mysql.com/doc/refman/5.5/en/drop-user.html

== grant user database ==
  * [mysql#login 登录 mysql server]
  * 执行以下 SQL 语句来允许用户访问指定的数据库
{{{
# 赋予用户 tom 通过 localhost 操作数据库 web_db (全部权限)
GRANT ALL ON web_db.* TO 'tom'@'localhost';
}}}

== edit user password ==
  * [mysql#login 登录 mysql server]
  * 执行以下 SQL 语句来修改指定用户密码
{{{
# 修改用户 bob 的密码为 newpass
UPDATE mysql.user SET Password=PASSWORD('newpass') WHERE User='bob';
FLUSH PRIVILEGES;
}}}
  * 备注
    * 修改用户密码不要使用 SET PASSWORD, 因为这个命令可能会被记录到 server log 或  ~/.mysql_history 文件中，从而导致密码泄露
    * 详见 http://dev.mysql.com/doc/refman/5.5/en/set-password.html

== start with os ==
  * 设置 mysql server 随系统启动和关闭
{{{
cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysql.server
ln -s /etc/init.d/mysql.server /etc/rc3.d/S99mysql
ln -s /etc/init.d/mysql.server /etc/rc0.d/K01mysql
}}}

== security ==
  * 安装好 mysql 后需要先做好安全工作
  * [mysql#login 登录 mysql server] (备注：root 用户初始密码为空)
  * 执行以下 SQL 语句
{{{
# 列出当前已有用户
SELECT user, host, password FROM mysql.user;

# 删除匿名用户和没有密码的用户
DELETE FROM mysql.user WHERE user = "" OR password = "";

# 去掉默认允许的全部用户对 test 前缀的数据库的访问权限
DELETE FROM mysql.db WHERE Db LIKE 'test%';

# 重新创建一个具有root权限的用户（root）和密码（12345678）
GRANT ALL PRIVILEGES ON *.* TO 'root'@'localhost' IDENTIFIED BY '12345678';
GRANT ALL PRIVILEGES ON *.* TO 'root'@'127.0.0.1' IDENTIFIED BY '12345678';

# 令以上操作立即生效
FLUSH PRIVILEGES;
}}}

== reset root password ==
  * 如果忘记 root 用户密码可以通过以下方式来重置密码
  * 详见 http://dev.mysql.com/doc/refman/5.5/en/resetting-permissions.html#resetting-permissions-unix


----


= how to install mysql server 5.1.58 =



----


= how to install mysql server 5.5.15 =

== 1. 准备工作 ==
  * 以 root 用户身份登录
{{{
su root
}}}
  * 创建运行 mysql server 的用户
{{{
groupadd mysql

# 注意必须禁止该用户使用远程登录
useradd -M -r -s /sbin/nologin -g mysql mysql
}}}
  * 创建以下目录
{{{
mkdir -p /root/software
}}}

== 2. 下载 ==
{{{
cd /root/software

# 下载 mysql 源代码
wget http://popsrc.googlecode.com/files/mysql-5.5.15.tar.gz

# 下载编译安装 mysql 源代码所需软件
wget http://popsrc.googlecode.com/files/cmake-2.8.5.tar.gz
}}}

== 3. 安装 ==
  * 安装 cmake
{{{
cd /root/software
tar zxvf cmake-2.8.5.tar.gz
cd cmake-2.8.5
./bootstrap
make && make install
}}}
  * 安装 mysql
{{{
cd /root/software
tar zxvf mysql-5.5.15.tar.gz
cd mysql-5.5.15
cmake .
make && make install
}}}

== 4. 初始化 mysql ==
{{{
chown -R mysql:mysql /usr/local/mysql
/usr/local/mysql/scripts/mysql_install_db --user=mysql --force
chown -R root /usr/local/mysql
chown -R mysql /usr/local/mysql/data
}}}

== 5. mysql 配置文件 ==
{{{
cp /usr/local/mysql/support-files/my-medium.cnf /etc/my.cnf

# 用 vi 打开 /etc/my.cnf, 将 `[mysqld]` 下面的 max_allowed_packet 修改为以下值
# max_allowed_packet = 32M
}}}

== 6. [mysql#start_with_os 设置 mysql server 随系统启动和关闭] ==

== 7. [mysql#start 手工启动 mysql] ==

== 8. [mysql#security mysql 数据库安全设置] ==

== 9. [mysql#uninstall 卸载 mysql server] ==



----



= how to install multi mysql server=

== 第一种、安装多个同一版本的 mysql server ==
=== 1. 以正常方式安装好 mysql server ===

== 第二种、安装多个不同版本的 mysql server ==


----

= available options for configuring mysql =

== 参考文档 ==
  * Autotools to CMake Transition Guide
    * http://forge.mysql.com/wiki/Autotools_to_CMake_Transition_Guide

==  configure mysql 5.1.58 ==
  * 当需要重新编译时需要执行以下 shell 命令
{{{
make clean
rm config.cache
}}}

==  configure mysql 5.5.15 ==
  * 当需要重新编译时需要执行以下 shell 命令
{{{
make clean
rm CMakeCache.txt
}}}

== Installation Layout Options ==
|| *Parameter* ||  *configure Option* ||  *CMake Option* ||  *CMake Notes* ||
|| Installation base directory ||  --prefix=/usr ||  -DCMAKE_INSTALL_PREFIX=/usr ||
|| mysqld directory ||  --libexecdir=/usr/sbin ||  -DINSTALL_SBINDIR=sbin ||  interpreted relative to prefix ||
|| Data directory ||  --localstatedir=/var/lib/mysql ||  -DMYSQL_DATADIR=/var/lib/mysql ||
|| Config directory (for my.cnf) ||  --sysconfdir=/etc/mysql ||  -DSYSCONFDIR=/etc/mysql ||
|| Plugin directory ||  --with-plugindir=/usr/lib64/mysql/plugin ||  -DINSTALL_PLUGINDIR=lib64/mysql/plugin ||  interpreted relative to prefix ||
|| Man page directory ||  --mandir=/usr/share/man ||  -DINSTALL_MANDIR=share/man ||  interpreted relative to prefix ||
|| Shared-data directory ||  --sharedstatedir=/usr/share/mysql ||  -DINSTALL_SHAREDIR=share ||  this is where aclocal/mysql.m4 should be installed ||
|| Library installation directory ||  --libdir=/usr/lib64/mysql ||  -DINSTALL_LIBDIR=lib64/mysql ||  interpreted relative to prefix ||
|| Header installation directory ||  --includedir=/usr/include/mysql ||  -DINSTALL_INCLUDEDIR=include/mysql ||  interpreted relative to prefix ||
|| Info doc directory ||  --infodir=/usr/share/info ||  -DINSTALL_INFODIR=share/info ||  interpreted relative to prefix ||


----

= how to uninstall mysql server =

== 1. [mysql#backup 先备份数据] ==
== 2. [mysql#stop 停止 mysql server] ==
== 3. 执行以下 shell 命令来卸载 mysql server ==
{{{
# 取消随机启动设置
rm -f /etc/rc0.d/K01mysql
rm -f /etc/rc3.d/S99mysql
rm -f /etc/init.d/mysql.server

# 删除 mysql 的配置文件
rm -f /etc/my.cnf

# 删除 mysql 相关文件 (再次提醒一定要先备份好数据)
rm -fr /usr/local/mysql
}}}