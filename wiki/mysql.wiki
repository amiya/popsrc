
= 特别注意 =
以下操作仅在 CentOS 5.5 测试通过，未在其它操作系统测试。

= 快速链接 =
  * [mysql#MySQL_Basic_Operation MySQL Basic Operation]
    * [mysql#start 手工启动 mysql server]
    * [mysql#stop 手工停止 mysql server]
    * [mysql#login 登录 mysql server]
    * [mysql#backup 备份数据]
    * [mysql#create_database 创建新数据库]
    * [mysql#create_user 创建新用户]
    * [mysql#grant_user_database 赋予用户操作指定数据库的权限]
    * [mysql#delete_user 删除用户]
    * [mysql#edit_user_password 修改指定用户密码]
    * [mysql#start_with_os 设置 mysql server 随系统启动和关闭]
    * [mysql#security mysql 数据库安全设置]
    * [mysql#uninstall 卸载 mysql server]
  * [mysql#how_to_install_mysql_server_5.1.58 how to install mysql server 5.1.58]
  * [mysql#how_to_install_mysql_server_5.5.15 how to install mysql server 5.5.15]
  * [mysql#how_to_install_multi_mysql_server_5.5.15 how to install multi mysql server 5.5.15]

= 参考文档 =
  * http://dev.mysql.com/doc/refman/5.5/en/installing-source-distribution.html
  * http://dev.mysql.com/doc/refman/5.5/en/default-privileges.html
  * http://blog.s135.com/nginx_php_v6/
  * http://pengranxiang.iteye.com/blog/1138059



----

= MySQL Basic Operation =

== start ==
  * 手工启动 mysql
{{{
/usr/local/mysql/bin/mysqld_safe --user=mysql &
}}}

== stop ==
  * 手工停止 mysql (需要输入 root 用户密码)
{{{
/usr/local/mysql/bin/mysqladmin -u root -p shutdown
}}}

== login ==
 * 登录 mysql server
{{{
# 以 root 用户登录 (接下来将提示输入密码)
/usr/local/mysql/bin/mysql -u root -p
}}}


== backup ==
  * 备份数据

== create database ==
  * [mysql#login 登录 mysql server]
  * 执行以下 SQL 语句来创建新数据库
{{{
# 创建新数据库 web_db, 使用 utf8 字符集
CREATE DATABASE `web_db` CHARACTER SET utf8 ;
}}}

== create user ==
  * [mysql#login 登录 mysql server]
  * 执行以下 SQL 语句来创建新用户
{{{
# 创建新用户 tom, 密码是 mypass, 只允许通过 localhost 连接 mysql server (如果希望允许远程登录, 则将 localhost 改为 %)
CREATE USER 'tom'@'localhost' IDENTIFIED BY 'mypass';
}}}

== delete user ==
  * [mysql#login 登录 mysql server]
  * 执行以下 SQL 语句来删除用户
{{{
# 删除用户 tom
DELETE FROM mysql.user WHERE user = "tom";
FLUSH PRIVILEGES;
}}}
  * 备注
    * 删除用户也可以使用 DROP USER `[username]`，但需要指定 hostname
    * 详见 http://dev.mysql.com/doc/refman/5.5/en/drop-user.html

== grant user database ==
  * [mysql#login 登录 mysql server]
  * 执行以下 SQL 语句来允许用户访问指定的数据库
{{{
# 赋予用户 tom 通过 localhost 操作数据库 web_db (全部权限)
GRANT ALL ON web_db.* TO 'tom'@'localhost';
}}}

== edit user password ==
  * [mysql#login 登录 mysql server]
  * 执行以下 SQL 语句来修改指定用户密码
{{{
# 修改用户 bob 的密码为 newpass
UPDATE mysql.user SET Password=PASSWORD('newpass') WHERE User='bob';
FLUSH PRIVILEGES;
}}}
  * 备注
    * 修改用户密码不要使用 SET PASSWORD, 因为这个命令可能会被记录到 server log 或  ~/.mysql_history 文件中，从而导致密码泄露
    * 详见 http://dev.mysql.com/doc/refman/5.5/en/set-password.html

== start with os ==
  * 设置 mysql server 随系统启动和关闭
{{{
cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysql.server
ln -s /etc/init.d/mysql.server /etc/rc3.d/S99mysql
ln -s /etc/init.d/mysql.server /etc/rc0.d/K01mysql
}}}

== security ==
  * 安装好 mysql 后需要先做好安全工作
  * [mysql#login 登录 mysql server] (备注：root 用户初始密码为空)
  * 执行以下 SQL 语句
{{{
# 列出当前已有用户
SELECT user, host, password FROM mysql.user;

# 删除匿名用户和没有密码的用户
DELETE FROM mysql.user WHERE user = "" OR password = "";

# 去掉默认允许的全部用户对 test 前缀的数据库的访问权限
DELETE FROM mysql.db WHERE Db LIKE 'test%';

# 重新创建一个具有root权限的用户（root）和密码（12345678）
GRANT ALL PRIVILEGES ON *.* TO 'root'@'localhost' IDENTIFIED BY '12345678';
GRANT ALL PRIVILEGES ON *.* TO 'root'@'127.0.0.1' IDENTIFIED BY '12345678';

# 令以上操作立即生效
FLUSH PRIVILEGES;
}}}


== uninstall ==
  * [mysql#backup 先备份数据]
  * 接着 [mysql#stop 停止 mysql server]
  * 然后执行以下 shell 命令来卸载 mysql server
{{{
# 取消随机启动设置
rm -f /etc/rc0.d/K01mysql
rm -f /etc/rc3.d/S99mysql
rm -f /etc/init.d/mysql.server

# 删除 mysql 的配置文件
rm -f /etc/my.cnf

# 删除 mysql 相关文件 (再次提醒一定要先备份好数据)
rm -fr /usr/local/mysql
}}}

----


= how to install mysql server 5.1.58 =



----


= how to install mysql server 5.5.15 =

== 1. 准备工作 ==
  * 以 root 用户身份登录
{{{
su root
}}}
  * 创建运行 mysql server 的用户
{{{
groupadd mysql

# 注意必须禁止该用户使用远程登录
useradd -M -r -s /sbin/nologin -g mysql mysql
}}}
  * 创建以下目录
{{{
mkdir -p /root/software
}}}

== 2. 下载 ==
{{{
cd /root/software

# 下载 mysql 源代码
wget http://popsrc.googlecode.com/files/mysql-5.5.15.tar.gz

# 下载编译安装 mysql 源代码所需软件
wget http://popsrc.googlecode.com/files/cmake-2.8.5.tar.gz
}}}

== 3. 安装 ==
  * 安装 cmake
{{{
cd /root/software
tar zxvf cmake-2.8.5.tar.gz
cd cmake-2.8.5
./bootstrap
make && make install
}}}
  * 安装 mysql
{{{
cd /root/software
tar zxvf mysql-5.5.15.tar.gz
cd mysql-5.5.15
cmake .
make && make install
}}}

== 4. 初始化 mysql ==
{{{
chown -R mysql:mysql /usr/local/mysql
/usr/local/mysql/scripts/mysql_install_db --user=mysql
chown -R root /usr/local/mysql
chown -R mysql /usr/local/mysql/data
}}}

== 5. mysql 配置文件 ==
{{{
cp /usr/local/mysql/support-files/my-medium.cnf /etc/my.cnf

# 用 vi 打开 /etc/my.cnf, 将 `[mysqld]` 下面的 max_allowed_packet 修改为以下值
# max_allowed_packet = 32M
}}}

== 6. [mysql#start_with_os 设置 mysql server 随系统启动和关闭] ==

== 7. [mysql#start 手工启动 mysql] ==

== 8. [mysql#security mysql 数据库安全设置] ==

== 9. [mysql#uninstall 卸载 mysql server] ==



----



= how to install multi mysql server 5.5.15 =


